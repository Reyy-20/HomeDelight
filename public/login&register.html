<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/Style.css">
     <link rel="stylesheet" href="css/Header.css">
</head>
<body>
 <!-- Login Modal -->
  <div id="loginModal" class="login-modal">
    <div class="login-modal-content">
        <button class="close-modal" onclick="closeLoginModal()">&times;</button>
        
        <!-- Login Options -->
        <div id="loginOptions" class="login-options-container">
            <div class="login-modal-header">
                <h2>Iniciar Sesión / Registro</h2>
                <p>Elige el tipo de cuenta con el que quieres acceder</p>
            </div>
            
            <div class="login-options">
                <div class="login-option" onclick="showLoginForm('user-login')">
                    <h3>Cliente</h3>
                    <p>Accede a tu cuenta de cliente para explorar propiedades</p>
                </div>
                
                <div class="login-option" onclick="showLoginForm('business-login')">
                    <h3>Negocio</h3>
                    <p>Accede a tu cuenta de negocio para gestionar propiedades</p>
                </div>
                
                <div class="login-option" onclick="showLoginForm('user-register')">
                    <h3>Registrar Cliente</h3>
                    <p>Crea una nueva cuenta de cliente</p>
                </div>
                
                <div class="login-option" onclick="showLoginForm('business-register')">
                    <h3>Registrar Negocio</h3>
                    <p>Crea una nueva cuenta de negocio</p>
                </div>
            </div>
        </div>

        <!-- User Login Form -->
        <div id="user-login-form" class="login-form-container">
            <button class="back-to-options" onclick="showLoginOptions()">← Volver a opciones</button>
            <div class="login-modal-header">
                <h2>Login de Cliente</h2>
            </div>
            <form id="userLoginForm">
                <div>
                    <label for="user-email">Correo electrónico:</label>
                    <input type="email" id="user-email" name="email" required>
                </div>
                <div>
                    <label for="user-password">Contraseña:</label>
                    <input type="password" id="user-password" name="password" required>
                </div>
                <button type="submit">Iniciar sesión</button>
            </form>
            <div id="user-login-error" style="color:#a0793d; margin-top:10px;"></div>
        </div>

        <!-- Business Login Form -->
        <div id="business-login-form" class="login-form-container">
            <button class="back-to-options" onclick="showLoginOptions()">← Volver a opciones</button>
            <div class="login-modal-header">
                <h2>Login de Negocio</h2>
            </div>
            <form id="businessLoginForm">
                <div>
                    <label for="business-email">Email:</label>
                    <input type="email" id="business-email" name="email" required>
                </div>
                <div>
                    <label for="business-password">Password:</label>
                    <input type="password" id="business-password" name="password" required>
                </div>
                <div>
                    <label for="business-phone">Phone Number:</label>
                    <input type="tel" id="business-phone" name="phone" required>
                </div>
                <button type="submit">Sign In</button>
            </form>
            <div id="business-login-error" style="color:#a0793d; margin-top:10px;"></div>
        </div>

        <!-- User Register Form -->
        <div id="user-register-form" class="login-form-container">
            <button class="back-to-options" onclick="showLoginOptions()">← Volver a opciones</button>
            <div class="login-modal-header">
                <h2>Registro de Cliente</h2>
            </div>
            <form id="userRegisterForm">
                <div>
                    <label for="user-reg-name">Nombre completo:</label>
                    <input type="text" id="user-reg-name" name="name" required>
                </div>
                <div>
                    <label for="user-reg-email">Correo electrónico:</label>
                    <input type="email" id="user-reg-email" name="email" required>
                </div>
                <div>
                    <label for="user-reg-password">Contraseña:</label>
                    <input type="password" id="user-reg-password" name="password" required>
                </div>
                <div>
                    <label for="user-reg-phone">Teléfono:</label>
                    <input type="tel" id="user-reg-phone" name="phone" required>
                </div>
                <button type="submit">Registrarse</button>
            </form>
            <div id="user-register-error" style="color:#a0793d; margin-top:10px;"></div>
        </div>

        <!-- Business Register Form -->
        <div id="business-register-form" class="login-form-container">
            <button class="back-to-options" onclick="showLoginOptions()">← Volver a opciones</button>
            <div class="login-modal-header">
                <h2>Registro de Negocio</h2>
            </div>
            <form id="businessRegisterForm">
                <div>
                    <label for="business-reg-name">Business Name:</label>
                    <input type="text" id="business-reg-name" name="biz_name" required>
                </div>
                <div>
                    <label for="business-reg-email">Business Email:</label>
                    <input type="email" id="business-reg-email" name="biz_email" required>
                </div>
                <div>
                    <label for="business-reg-password">Password:</label>
                    <input type="password" id="business-reg-password" name="biz_password" required>
                </div>
                <div>
                    <label for="business-reg-phone">Business Phone:</label>
                    <input type="tel" id="business-reg-phone" name="biz_phone">
                </div>
                <div>
                    <label for="business-reg-address">Business Address:</label>
                    <input type="text" id="business-reg-address" name="biz_address">
                </div>
                <div>
                    <label for="business-reg-license">Business License Number:</label>
                    <input type="text" id="business-reg-license" name="biz_license">
                </div>
                <button type="submit">Register Business</button>
            </form>
            <div id="business-register-error" style="color:#a0793d; margin-top:10px;"></div>
        </div>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

<!-- Authentication Scripts -->
<script src="js/firebase-config.js"></script>
<script src="js/firebase-error-handler.js"></script>
<script src="js/auth.js"></script>
<script src="js/notification.js"></script>

<script>
    // Modal functionality
    function openLoginModal() {
        document.getElementById('loginModal').classList.add('show');
        showLoginOptions();
    }

    function closeLoginModal() {
        document.getElementById('loginModal').classList.remove('show');
        showLoginOptions();
    }

    function showLoginOptions() {
        document.getElementById('loginOptions').style.display = 'block';
        document.querySelectorAll('.login-form-container').forEach(form => {
            form.classList.remove('active');
        });
    }

    function showLoginForm(formType) {
        document.getElementById('loginOptions').style.display = 'none';
        document.querySelectorAll('.login-form-container').forEach(form => {
            form.classList.remove('active');
        });
        document.getElementById(formType + '-form').classList.add('active');
    }

    // Close modal when clicking outside
    document.getElementById('loginModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeLoginModal();
        }
    });

    // Add click event to "LogIn/register" link
    document.addEventListener('DOMContentLoaded', function() {
        const loginLink = document.querySelector('a[href="#"]:contains("LogIn/register")');
        if (!loginLink) {
            // Try alternative selector
            const loginLinks = document.querySelectorAll('.nav-link');
            loginLinks.forEach(link => {
                if (link.textContent.trim() === 'LogIn/register') {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        openLoginModal();
                    });
                }
            });
        } else {
            loginLink.addEventListener('click', function(e) {
                e.preventDefault();
                openLoginModal();
            });
        }
    });

    // Form submissions
    document.getElementById('userLoginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('user-email').value;
        const password = document.getElementById('user-password').value;
        const errorDiv = document.getElementById('user-login-error');
        
        try {
            const result = await authManager.login(email, password);
            if (result.success) {
                notificationManager.showSuccess('¡Inicio de sesión exitoso!');
                closeLoginModal();
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } else {
                errorDiv.textContent = result.error;
            }
        } catch (error) {
            errorDiv.textContent = 'Error durante el inicio de sesión. Por favor, inténtalo de nuevo.';
        }
    });

    document.getElementById('businessLoginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('business-email').value;
        const password = document.getElementById('business-password').value;
        const errorDiv = document.getElementById('business-login-error');
        
        try {
            const result = await authManager.login(email, password);
            if (result.success) {
                notificationManager.showSuccess('¡Inicio de sesión exitoso!');
                closeLoginModal();
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } else {
                errorDiv.textContent = result.error;
            }
        } catch (error) {
            errorDiv.textContent = 'Error durante el inicio de sesión. Por favor, inténtalo de nuevo.';
        }
    });

    document.getElementById('userRegisterForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('user-reg-name').value;
        const email = document.getElementById('user-reg-email').value;
        const password = document.getElementById('user-reg-password').value;
        const phone = document.getElementById('user-reg-phone').value;
        const errorDiv = document.getElementById('user-register-error');
        
        try {
            const result = await authManager.register(email, password, { name, phone });
            if (result.success) {
                notificationManager.showSuccess('¡Registro exitoso!');
                closeLoginModal();
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } else {
                errorDiv.textContent = result.error;
            }
        } catch (error) {
            errorDiv.textContent = 'Error durante el registro. Por favor, inténtalo de nuevo.';
        }
    });

    document.getElementById('businessRegisterForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const bizName = document.getElementById('business-reg-name').value;
        const email = document.getElementById('business-reg-email').value;
        const password = document.getElementById('business-reg-password').value;
        const phone = document.getElementById('business-reg-phone').value;
        const address = document.getElementById('business-reg-address').value;
        const license = document.getElementById('business-reg-license').value;
        const errorDiv = document.getElementById('business-register-error');
        
        try {
            const result = await authManager.register(email, password, { 
                bizName, phone, address, license 
            });
            if (result.success) {
                notificationManager.showSuccess('¡Registro de negocio exitoso!');
                closeLoginModal();
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } else {
                errorDiv.textContent = result.error;
            }
        } catch (error) {
            errorDiv.textContent = 'Error durante el registro. Por favor, inténtalo de nuevo.';
        }
    });
    </script>
    <script src="js/script.js"></script>
</body>
</html>